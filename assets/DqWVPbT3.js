import{l as b,o as E,c as g,y as _,F as S,G as O,H as $,I as j,e as A,f as J,r as w,J as y,K as F}from"./Buz6ZR34.js";import{u as P}from"./C-8BIbgx.js";import{_ as Y}from"./DlAUqK2U.js";class m extends Error{constructor(a){super(a),this.message=a,Object.setPrototypeOf(this,m.prototype)}}const k=b({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:a,emit:n}){const i=j(),u=P(`form-${i}`);A(()=>{u.on(async t=>{var s;t.type!=="submit"&&((s=e.validateOn)!=null&&s.includes(t.type))&&await d(t.path,{silent:!0})})}),J(()=>{u.reset()});const r=w([]);y("form-errors",r),y("form-events",u);const c=w({});y("form-inputs",c);async function h(){let t=await e.validate(e.state);if(e.schema)if(U(e.schema))t=t.concat(await V(e.state,e.schema));else if(B(e.schema))t=t.concat(await M(e.state,e.schema));else if(Z(e.schema))t=t.concat(await x(e.state,e.schema));else if(z(e.schema))t=t.concat(await C(e.state,e.schema));else throw new Error("Form validation failed: Unsupported form schema");return t}async function d(t,s={silent:!1}){let o=t;if(t&&!Array.isArray(t)&&(o=[t]),o){const f=r.value.filter(l=>!o.includes(l.path)),v=(await h()).filter(l=>o.includes(l.path));r.value=f.concat(v)}else r.value=await h();if(r.value.length>0){if(s.silent)return!1;throw new m(`Form validation failed: ${JSON.stringify(r.value,null,2)}`)}return e.state}async function p(t){var o;const s=t;try{(o=e.validateOn)!=null&&o.includes("submit")&&await d(),s.data=e.state,n("submit",s)}catch(f){if(!(f instanceof m))throw f;const v={...s,errors:r.value.map(l=>({...l,id:c.value[l.path]}))};n("error",v)}}return a({validate:d,errors:r,setErrors(t,s){s?r.value=r.value.filter(o=>o.path!==s).concat(t):r.value=t},async submit(){await p(new Event("submit"))},getErrors(t){return t?r.value.filter(s=>s.path===t):r.value},clear(t){t?r.value=r.value.filter(s=>s.path!==t):r.value=[]}}),{onSubmit:p,errors:F(r)}}});function B(e){return e.validate&&e.__isYupSchema__}function I(e){return e.inner!==void 0}async function M(e,a){try{return await a.validate(e,{abortEarly:!1}),[]}catch(n){if(I(n))return n.inner.map(i=>({path:i.path??"",message:i.message}));throw n}}function U(e){return e.parse!==void 0}async function V(e,a){const n=await a.safeParseAsync(e);return n.success===!1?n.error.issues.map(i=>({path:i.path.join("."),message:i.message})):[]}function Z(e){return e.validateAsync!==void 0&&e.id!==void 0}function q(e){return e.isJoi===!0}async function x(e,a){try{return await a.validateAsync(e,{abortEarly:!1}),[]}catch(n){if(q(n))return n.details.map(i=>({path:i.path.join("."),message:i.message}));throw n}}function z(e){return"_parse"in e||"_run"in e||typeof e=="function"&&"schema"in e}async function C(e,a){var i;return((i=(await("_parse"in a?a._parse(e):"_run"in a?a._run({typed:!1,value:e},{}):a(e))).issues)==null?void 0:i.map(u=>{var r;return{path:((r=u.path)==null?void 0:r.map(c=>c.key).join("."))||"",message:u.message}}))||[]}function G(e,a,n,i,u,r){return E(),g("form",{onSubmit:a[0]||(a[0]=$((...c)=>e.onSubmit&&e.onSubmit(...c),["prevent"]))},[_(e.$slots,"default",S(O({errors:e.errors})))],32)}const R=Y(k,[["render",G]]);export{R as _};
