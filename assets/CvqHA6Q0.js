import{m as P,a9 as R,l as z,q as I,s as $,t as _,v as j,r as b,a4 as Y,o as O,R as D,aa as H,x as U,y as x,z as Z,g as C,c as A,e as G,B as K,D as k,n as L,ab as Q,ac as W,ad as X,ae as ee,af as ae,a as te,ag as B,ah as re}from"./-fzKhrZJ.js";import{u as ne}from"./CNiysmtb.js";import{u as se}from"./adrv9NTP.js";const v=P(z.ui.strategy,z.ui.textarea,R),oe=$({inheritAttrs:!1,props:{modelValue:{type:[String,Number],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},rows:{type:Number,default:3},maxrows:{type:Number,default:0},autoresize:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},autofocusDelay:{type:Number,default:100},resize:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},size:{type:String,default:null,validator(e){return Object.keys(v.size).includes(e)}},color:{type:String,default:()=>v.default.color,validator(e){return[...z.ui.colors,...Object.keys(v.color)].includes(e)}},variant:{type:String,default:()=>v.default.variant,validator(e){return[...Object.keys(v.variant),...Object.values(v.color).flatMap(t=>Object.keys(t))].includes(e)}},textareaClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})},modelModifiers:{type:Object,default:()=>({})}},emits:["update:modelValue","blur","change"],setup(e,{emit:t}){const{ui:r,attrs:l}=_("textarea",j(e,"ui"),v,j(e,"class")),{emitFormBlur:d,emitFormInput:s,inputId:u,color:g,size:y,name:h}=ne(e,v),a=b(Y({},e.modelModifiers,{trim:!1,lazy:!1,number:!1})),n=b(null),i=()=>{var o;e.autofocus&&((o=n.value)==null||o.focus())},c=()=>{if(e.autoresize){if(!n.value)return;n.value.rows=e.rows;const o=n.value.style.overflow;n.value.style.overflow="hidden";const f=window.getComputedStyle(n.value),w=parseInt(f.paddingTop),N=parseInt(f.paddingBottom),q=w+N,J=parseInt(f.lineHeight),{scrollHeight:T}=n.value,E=(T-q)/J;E>e.rows&&(n.value.rows=e.maxrows?Math.min(E,e.maxrows):E),n.value.style.overflow=o}},p=o=>{a.value.trim&&(o=o.trim()),a.value.number&&(o=Q(o)),t("update:modelValue",o),s()},m=o=>{c(),a.value.lazy||p(o.target.value)},F=o=>{const f=o.target.value;t("change",f),a.value.lazy&&p(f),a.value.trim&&(o.target.value=f.trim())},M=o=>{t("blur",o),d()};O(()=>{setTimeout(()=>{i()},e.autofocusDelay)}),D(()=>e.modelValue,()=>{H(c)}),O(()=>{setTimeout(()=>{i(),c()},100)});const V=U(()=>{var f,w;const o=((w=(f=r.value.color)==null?void 0:f[g.value])==null?void 0:w[e.variant])||r.value.variant[e.variant];return x(Z(r.value.base,r.value.form,r.value.rounded,r.value.placeholder,r.value.size[y.value],e.padded?r.value.padding[y.value]:"p-0",o==null?void 0:o.replaceAll("{color}",g.value),!e.resize&&"resize-none"),e.textareaClass)});return{ui:r,attrs:l,name:h,inputId:u,textarea:n,textareaClass:V,onInput:m,onChange:F,onBlur:M}}}),le=["id","value","name","rows","required","disabled","placeholder"];function ue(e,t,r,l,d,s){return C(),A("div",{class:L(e.ui.wrapper)},[G("textarea",K({id:e.inputId,ref:"textarea",value:e.modelValue,name:e.name,rows:e.rows,required:e.required,disabled:e.disabled,placeholder:e.placeholder,class:e.textareaClass},e.attrs,{onInput:t[0]||(t[0]=(...u)=>e.onInput&&e.onInput(...u)),onBlur:t[1]||(t[1]=(...u)=>e.onBlur&&e.onBlur(...u)),onChange:t[2]||(t[2]=(...u)=>e.onChange&&e.onChange(...u))}),null,16,le),k(e.$slots,"default")],2)}const ze=I(oe,[["render",ue]]);class S extends Error{constructor(t){super(t),this.message=t,Object.setPrototypeOf(this,S.prototype)}}const ie=$({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:t,emit:r}){const l=ae(),d=se(`form-${l}`);O(()=>{d.on(async a=>{var n;a.type!=="submit"&&((n=e.validateOn)!=null&&n.includes(a.type))&&await y(a.path,{silent:!0})})}),te(()=>{d.reset()});const s=b([]);B("form-errors",s),B("form-events",d);const u=b({});B("form-inputs",u);async function g(){let a=await e.validate(e.state);if(e.schema)if(me(e.schema))a=a.concat(await ve(e.state,e.schema));else if(de(e.schema))a=a.concat(await ce(e.state,e.schema));else if(ye(e.schema))a=a.concat(await ge(e.state,e.schema));else if(he(e.schema))a=a.concat(await we(e.state,e.schema));else throw new Error("Form validation failed: Unsupported form schema");return a}async function y(a,n={silent:!1}){let i=a;if(a&&!Array.isArray(a)&&(i=[a]),i){const c=s.value.filter(m=>!i.includes(m.path)),p=(await g()).filter(m=>i.includes(m.path));s.value=c.concat(p)}else s.value=await g();if(s.value.length>0){if(n.silent)return!1;throw new S(`Form validation failed: ${JSON.stringify(s.value,null,2)}`)}return e.state}async function h(a){var i;const n=a;try{(i=e.validateOn)!=null&&i.includes("submit")&&await y(),n.data=e.state,r("submit",n)}catch(c){if(!(c instanceof S))throw c;const p={...n,errors:s.value.map(m=>({...m,id:u.value[m.path]}))};r("error",p)}}return t({validate:y,errors:s,setErrors(a,n){n?s.value=s.value.filter(i=>i.path!==n).concat(a):s.value=a},async submit(){await h(new Event("submit"))},getErrors(a){return a?s.value.filter(n=>n.path===a):s.value},clear(a){a?s.value=s.value.filter(n=>n.path!==a):s.value=[]}}),{onSubmit:h,errors:re(s)}}});function de(e){return e.validate&&e.__isYupSchema__}function fe(e){return e.inner!==void 0}async function ce(e,t){try{return await t.validate(e,{abortEarly:!1}),[]}catch(r){if(fe(r))return r.inner.map(l=>({path:l.path??"",message:l.message}));throw r}}function me(e){return e.parse!==void 0}async function ve(e,t){const r=await t.safeParseAsync(e);return r.success===!1?r.error.issues.map(l=>({path:l.path.join("."),message:l.message})):[]}function ye(e){return e.validateAsync!==void 0&&e.id!==void 0}function pe(e){return e.isJoi===!0}async function ge(e,t){try{return await t.validateAsync(e,{abortEarly:!1}),[]}catch(r){if(pe(r))return r.details.map(l=>({path:l.path.join("."),message:l.message}));throw r}}function he(e){return"_parse"in e||"_run"in e||typeof e=="function"&&"schema"in e}async function we(e,t){var l;return((l=(await("_parse"in t?t._parse(e):"_run"in t?t._run({typed:!1,value:e},{}):t(e))).issues)==null?void 0:l.map(d=>{var s;return{path:((s=d.path)==null?void 0:s.map(u=>u.key).join("."))||"",message:d.message}}))||[]}function be(e,t,r,l,d,s){return C(),A("form",{onSubmit:t[0]||(t[0]=ee((...u)=>e.onSubmit&&e.onSubmit(...u),["prevent"]))},[k(e.$slots,"default",W(X({errors:e.errors})))],32)}const Oe=I(ie,[["render",be]]);export{Oe as _,ze as a};
